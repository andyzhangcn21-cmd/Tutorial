<?xml version="1.0" encoding="UTF-8"?>
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            elementFormDefault="qualified">

    <!-- 定义客户和订单类型 -->
    <xsd:complexType name="CustomerType">
        <xsd:sequence>
            <xsd:element name="id" type="xsd:int"/>
            <xsd:element name="name" type="xsd:string"/>
        </xsd:sequence>
    </xsd:complexType>

    <xsd:complexType name="OrderType">
        <xsd:sequence>
            <xsd:element name="orderId" type="xsd:int"/>
            <xsd:element name="customerId" type="xsd:int"/> <!-- 外键字段 -->
        </xsd:sequence>
    </xsd:complexType>

    <!-- 根元素（关键：将约束定义在共同的祖先元素中） -->
    <xsd:element name="root">
        <xsd:complexType>
            <xsd:sequence>
                <!-- 客户列表 -->
                <xsd:element name="customers" maxOccurs="1">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="customer" type="CustomerType" maxOccurs="unbounded"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>

                <!-- 订单列表 -->
                <xsd:element name="orders" maxOccurs="1">
                    <xsd:complexType>
                        <xsd:sequence>
                            <xsd:element name="order" type="OrderType" maxOccurs="unbounded"/>
                        </xsd:sequence>
                    </xsd:complexType>
                </xsd:element>
            </xsd:sequence>
        </xsd:complexType>

        <!-- 关键修复：将约束定义在根元素（客户和订单的共同祖先）中 -->
        <!-- 1. 定义客户ID的唯一约束（被引用的约束） -->
        <xsd:unique name="customerIdUnique">
            <xsd:selector xpath="customers/customer"/> <!-- 选择所有客户元素 -->
            <xsd:field xpath="id"/> <!-- 客户ID字段 -->
        </xsd:unique>

        <!-- 2. 定义订单的外键约束（引用上面的unique） -->
        <xsd:keyref name="orderCustomerFk" refer="customerIdUnique">
            <xsd:selector xpath="orders/order"/> <!-- 选择所有订单元素 -->
            <xsd:field xpath="customerId"/> <!-- 订单中的外键字段 -->
        </xsd:keyref>
    </xsd:element>

</xsd:schema>
    
